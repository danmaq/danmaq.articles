#!/bin/sh

if [ `which docker | wc -l` -eq 0 ]; then
  echo 'Docker service and client are required to run this setup.'
  exit 1
fi

mkdir -p tmp
mkdir -p _site

PJHOME=$(cd $(dirname $0)/..; pwd)

# ---- SET VOL1 ----
if [ $# -ge 1 ]; then
  VTHEME=$1
else
  VTHEME=${PJHOME}/tmp
fi
VOL1=${VTHEME}:/v/t:ro

# ---- SET VOL2 ----
VOL2=${PJHOME}:/v/a:ro

# ---- SET VOL2 ----
VOL3=${PJHOME}_site:/srv/jekyll/_site

CONTAINER=jekyll
IMAGE=danmaq/jekyll-git-redcarpet:github-pages
docker run -d -p 4000:4000 -v ${VOL1} -v ${VOL2} -v ${VOL3} --name ${CONTAINER} ${IMAGE} sh -c "mkdir /root/.ssh;while true; do sleep 1; done"

IP=`docker-machine ip docker`
printf "Please open via browser: \e[1;4mhttp://${IP}:4000\e[m\n"
docker exec -it ${CONTAINER} /v/test/incontainer
#docker exec -it ${CONTAINER} ash
docker rm -f ${CONTAINER}
