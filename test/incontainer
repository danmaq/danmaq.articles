#!/bin/sh

JEKYLL_WORK=/srv/jekyll
SRC_THEME=/v/danmaq.jekyll
SRC_ARTICLES=/v/danmaq.articles
THEME_HEAD=${SRC_THEME}/README.txt

cd /tmp
if [ -z "`ls ${SRC_THEME}`" -a `head -n 1 ${THEME_HEAD}` | grep 'Theme' ]; then
  echo 'Detected theme files. Skipping clone from GitHub.'
else
  git clone git@github.com:danmaq/danmaq.jekyll.git
fi

cp -rf ${SRC_ARTICLES}/_posts ${JEKYLL_WORK}/
cp -rf ${SRC_ARTICLES}/root/* ${JEKYLL_WORK}/
cp -rf ${SRC_THEME}/theme/* ${JEKYLL_WORK}/

rm -rf ${JEKYLL_WORK}/_site/*
cd ${JEKYLL_WORK}

# ビルド！
jekyll s
